<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventory - TML Spare Parts</title>
<link rel="stylesheet" href="style.css">
<script>
let quoteItems = [];

document.addEventListener('DOMContentLoaded', () => {
  fetch('inventory_from_csv.json')
    .then(response => response.json())
    .then(data => {
      const main = document.querySelector('main');
      const section = document.createElement('section');
      section.className = 'category';
      section.innerHTML = `<h2>Inventory Items</h2><div class='grid'></div>`;
      const grid = section.querySelector('.grid');

      data.forEach(item => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <img src="placeholder.jpg" alt="Item image">
          <h3>${item.DESCRIPTION}</h3>
          <p><strong>Model:</strong> ${item['MODEL NUMBER']}</p>
          <p><strong>Vehicle:</strong> ${item['TYPES OF VEHICLE']}</p>
          <p><strong>Price:</strong> ${item.PRICE}</p>
          <p><strong>Quantity:</strong> ${item.QUANTITY}</p>
          <button onclick='showDetail(${JSON.stringify(item)})'>View Details</button>
        `;
        grid.appendChild(div);
      });

      main.appendChild(section);
    });
});

function searchItems() {
  let input = document.getElementById('search').value.toLowerCase();
  let items = document.getElementsByClassName('item');
  for (let i = 0; i < items.length; i++) {
    let text = items[i].innerText.toLowerCase();
    items[i].style.display = text.includes(input) ? '' : 'none';
  }
}

function showDetail(item) {
  document.getElementById('detail-img').src = 'placeholder.jpg';
  document.getElementById('detail-title').textContent = item.DESCRIPTION;
  document.getElementById('detail-model').textContent = item['MODEL NUMBER'];
  document.getElementById('detail-price').textContent = item.PRICE;
  document.getElementById('detail-quantity').textContent = item.QUANTITY;
  document.getElementById('detail-description').textContent = "Detailed information about this spare part.";
  document.getElementById('detail-view').style.display = 'flex';
}

function closeDetail() {
  document.getElementById('detail-view').style.display = 'none';
}

function addToQuote() {
  const item = {
    description: document.getElementById('detail-title').textContent,
    model: document.getElementById('detail-model').textContent,
    price: document.getElementById('detail-price').textContent.replace('K', ''),
    quantity: document.getElementById('detail-quantity').textContent
  };
  quoteItems.push(item);
  alert(`${item.description} added to quote.`);
}

function showQuote() {
  let html = `
    <div class="quote-container">
      <h1>TSIRIN MOTORS LIMITED</h1>
      <h2>QUOTATION</h2>
      <p>Date: ${new Date().toLocaleDateString()}</p>
      <table>
        <thead>
          <tr>
            <th>Description</th><th>Qty</th><th>Unit Price</th><th>Amount</th>
          </tr>
        </thead>
        <tbody>
  `;
  let subtotal = 0;
  quoteItems.forEach(item => {
    const qty = parseInt(item.quantity || 1);
    const price = parseFloat(item.price) || 0;
    const amount = price * qty;
    subtotal += amount;
    html += `
      <tr>
        <td>${item.description}</td>
        <td>${qty}</td>
        <td>K${price.toFixed(2)}</td>
        <td>K${amount.toFixed(2)}</td>
      </tr>
    `;
  });
  const tax = subtotal * 0.10;
  const total = subtotal + tax;
  html += `
        </tbody>
      </table>
      <p><strong>Subtotal:</strong> K${subtotal.toFixed(2)}</p>
      <p><strong>Tax (10%):</strong> K${tax.toFixed(2)}</p>
      <h3>Total: K${total.toFixed(2)}</h3>
      <button onclick="window.print()">Print Quotation</button>
    </div>
  `;
  document.body.innerHTML = html;
}
</script>
</head>
<body>
<header>
  <h1>Inventory</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="inventory.html">Inventory</a>
    <button onclick="showQuote()">View Quote</button>
  </nav>
</header>
<main>
  <div class="search-bar">
    <input type="text" id="search" placeholder="Search inventory...">
    <button onclick="searchItems()">Search</button>
  </div>
</main>

<!-- Detail View Popup -->
<div id="detail-view" class="detail-view" style="display:none;">
  <div class="detail-container">
    <div class="detail-image">
      <img id="detail-img" src="placeholder.jpg" alt="Item image">
    </div>
    <div class="detail-info">
      <h2 id="detail-title"></h2>
      <p><strong>Model:</strong> <span id="detail-model"></span></p>
      <p><strong>Price:</strong> <span id="detail-price"></span></p>
      <p><strong>Quantity:</strong> <span id="detail-quantity"></span></p>
      <p id="detail-description"></p>
      <button onclick="addToQuote()">Add to Quote</button>
      <button onclick="closeDetail()">Close</button>
    </div>
  </div>
</div>

<footer>
  <p>&copy; 2025 TML Spare Parts</p>
</footer>
</body>
</html>