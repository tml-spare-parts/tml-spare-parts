<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventory - TML Spare Parts</title>
<link rel="stylesheet" href="style2.css">
<script>
document.addEventListener('DOMContentLoaded', () => {
  fetch('inventory_from_csv.json')
    .then(response => response.json())
    .then(data => {
      const main = document.querySelector('main');
      const section = document.createElement('section');
      section.className = 'category';
      section.innerHTML = `<h2>Inventory Items</h2><div class='grid'></div>`;
      const grid = section.querySelector('.grid');

      data.forEach(item => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <img src="placeholder.jpg" alt="Item Image">
          <h3>${item.DESCRIPTION}</h3>
          <p><strong>Model:</strong> ${item['MODEL NUMBER']}</p>
          <p><strong>Vehicle:</strong> ${item['TYPES OF VEHICLE']}</p>
          <p><strong>Price:</strong> ${item.PRICE}</p>
          <p><strong>Quantity:</strong> ${item.QUANTITY}</p>
          <button onclick='showDetail(${JSON.stringify(item)})'>View Details</button>
                  `;
        grid.appendChild(div);
      });

      main.appendChild(section);
    });
});

function searchItems() {
  let input = document.getElementById('search').value.toLowerCase();
  let items = document.getElementsByClassName('item');
  for (let i = 0; i < items.length; i++) {
    let text = items[i].innerText.toLowerCase();
    items[i].style.display = text.includes(input) ? '' : 'none';
  }
}

function showDetail(item) {
  document.getElementById('detail-img').src = 'placeholder.jpg';
  document.getElementById('detail-title').textContent = item.DESCRIPTION;
  document.getElementById('detail-model').textContent = item['MODEL NUMBER'];
  document.getElementById('detail-price').textContent = item.PRICE;
  document.getElementById('detail-quantity').textContent = item.QUANTITY;
  document.getElementById('detail-description').textContent = "Detailed information about this spare part.";
  document.getElementById('detail-view').style.display = 'flex';
}

function closeDetail() {
  document.getElementById('detail-view').style.display = 'none';
}

function addToQuote() {
  const item = {
    description: document.getElementById('detail-title').textContent,
    model: document.getElementById('detail-model').textContent,
    price: document.getElementById('detail-price').textContent.replace('K', ''),
    quantity: document.getElementById('detail-quantity').textContent
  };

  let quoteItems = JSON.parse(localStorage.getItem('quoteItems') || '[]');
  quoteItems.push(item);
  localStorage.setItem('quoteItems', JSON.stringify(quoteItems));

  alert(`${item.description} added to quote.`);
}

// âœ… Updated function to open quotation page in a new tab with confirmation
function goToQuotePage() {
  const quoteItems = JSON.parse(localStorage.getItem('quoteItems') || '[]');

  if (quoteItems.length === 0) {
    alert('Your quote is empty. Please add items before viewing the quote.');
    return;
  }

  const confirmOpen = confirm('Do you want to view your quotation in a new tab?');
  if (confirmOpen) {
    window.open('quotation.html', '_blank'); // Opens in a new tab
  }
}
</script>
</head>
<body>
<header>
  <h1>Inventory</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="inventory.html">Inventory</a>
    <button onclick="goToQuotePage()">View Quote</button>
  </nav>
</header>
<main>
  <div class="search-bar">
    <input type="text" id="search" placeholder="Search inventory...">
    <button onclick="searchItems()">Search</button>
  </div>
</main>

<!-- Detail View Popup -->
<div id="detail-view" class="detail-view" style="display:none;">
  <div class="detail-container">
    <div class="detail-image">
      <img id="detail-img" src="placeholder.jpg" alt="Item Image">
    </div>
    <div class="detail-info">
      <h2 id="detail-title"></h2>
      <p><strong>Model:</strong> <span id="detail-model"></span></p>
      <p><strong>Price:</strong> <span id="detail-price"></span></p>
      <p><strong>Quantity:</strong> <span id="detail-quantity"></span></p>
      <p id="detail-description"></p>
      <button onclick="addToQuote()">Add to Quote</button>
      <button onclick="closeDetail()">Close</button>
    </div>
  </div>
</div>

<footer>
  <p>&copy; 2025 TML Spare Parts</p>
</footer>
</body>
</html>